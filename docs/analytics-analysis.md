## Analytics Section – Scenarios, Risks, and Recommendations

### 1. Architecture Overview

- **Pages & Components**
  - `AnalyticsPage` (`/analytics`)\n    - Main listing of all analytics articles.\n    - Uses `useAnalytics({ type })` to fetch data, with client‑side filters:\n      - type filters: All / Expert / Markets / Longterm / Technical,\n      - author filter: list of authors with dynamic article counts,\n      - pagination (15 articles per page) over filtered array.\n    - Renders `AnalyticsCard` for each article.\n  - `AnalyticsCard`\n    - Displays article type badge, title, excerpt, read time, date, author avatar, and image.\n    - Links to the detailed analytics route (`/analytics/:slug` or equivalent, via router setup in `lib/api/index` + `fetchAnalyticsBySlug`).\n  - Other consumers\n    - Home page (`Index.tsx`) uses an `AnalyticsSection` to show a subset (e.g. featured/latest articles).\n    - Recommendations and search components may also use analytics data (via `useAnalytics` or direct API helpers).

- **Data layer**
  - `AnalyticsArticle` type (`src/lib/api/types.ts`)\n    - Core fields: `slug`, `title`, `excerpt`, `content`, `date`, `author`, `authorAvatar`, `type`, `readTime`, `imageUrl`.\n    - Optional metadata: `language`, `resources`, `images`, `sections`, `tags`, `relatedCompanies`, `relatedMarkets`.\n  - Article modules (`src/lib/api/analytics-*.ts`)\n    - Per‑author files: `analytics-christina`, `analytics-assunta`, `analytics-lysander`, `analytics-elias`, `analytics-anastasia`, `analytics-luca`, `analytics-isabelle`, `analytics-xu`, `analytics-radomir`, `analytics-olaf`.\n    - Each exports `*Articles: AnalyticsArticle[]` for that author.\n  - Aggregation (`src/lib/api/analytics.ts`)\n    - Imports all per‑author arrays and concatenates them into `quickAnalytics` (plus a small legacy section of articles defined inline).\n    - Provides `fetchAnalytics(type?: string, language?: string)` which:\n      - clones `quickAnalytics` into `result`,\n      - optionally filters by `type` (if not `'all'`),\n      - sorts by `date` descending.\n      - Note: `language` parameter is currently **ignored**; all articles are always returned in their original language.\n    - Provides `fetchAnalyticsBySlug(slug)` to resolve a single article by `slug` from `quickAnalytics` (or fall back to a more generic API).

- **Hooks**
  - `useAnalytics({ type? })`\n    - React Query wrapper around `fetchAnalytics`:\n      - `queryKey: ['analytics', { type: options?.type || 'all' }]`,\n      - `staleTime = 5min`, `gcTime = 10min`.\n    - Returns `AnalyticsArticle[]` for the requested `type` or all articles if `type` is omitted.

- **Assets and Authors**
  - `src/data/authors.ts` – defines analytics authors for filters (id, display_name, avatar_url, stats).\n  - `getAuthorAvatar` in `src/lib/api/utils.ts` – map from `author` display name → avatar URL (with DiceBear fallback).\n  - Article `imageUrl` is either:\n    - local asset via `getAnalyticsImage(slug) → /analytics/<slug>.jpg`, or\n    - direct external URL (e.g. Unsplash) for certain authors/series.

### 2. Key User Scenarios

1. **Browse analytics overview (`/analytics`)**\n   - User opens Analytics page.\n   - Sees:\n     - hero section with title & description,\n     - type filters (All / Expert / Markets / Longterm / Technical),\n     - author filter chips with article counts,\n     - grid of article cards with pagination.\n   - Expected:\n     - Filters and pagination reflect the same underlying article list.\n     - Author counts update correctly when type filter changes.\n     - No articles unexpectedly disappear when UI language changes.

2. **Filter by article type**\n   - User clicks on one of the type filters.\n   - Expected:\n     - Only articles with `article.type === selectedType` are shown.\n     - Author counts recompute from the type‑filtered subset.\n     - Pagination updates for the reduced set.

3. **Filter by author**\n   - User selects an author pill (e.g. Christina Summerbell, Anastasia Petrova).\n   - Expected:\n     - Only that author’s articles inside the current type filter are shown.\n     - Count next to the author pill matches the number of articles returned for that author under the current type filter.\n     - Switching back to \"All Authors\" shows the full type‑filtered list.

4. **Change site language**\n   - User toggles UI language (EN/PL/DE/RU, etc.).\n   - Expected:\n     - Analytics content (articles) remains in the language of authoring (EN/PL/DE/RU per article), not auto‑translated.\n     - Only UI labels and metadata (filters, headings, copy) change.\n     - The **set of articles** is identical regardless of locale.

5. **Open an individual analytics article**\n   - User clicks a card and navigates to article detail page (via router + `fetchAnalyticsBySlug`).\n   - Expected:\n     - Full `content` is rendered with markdown styling.\n     - `readTime`, date, type badge, author info and image are consistent with the card.\n     - If user bookmarks/saves/returns from detail, the card list is unchanged.

6. **Use analytics in other contexts (home, recommendations)**\n   - Other components use analytics data to show featured or recommended content.\n   - Expected:\n     - They pull from the same canonical `quickAnalytics` (or via `fetchAnalytics`/`useAnalytics`) so counts and sets match `/analytics`.\n     - There is no divergence between what is \"featured\" and what is available in the main list (other than intentional selection).

### 3. Identified / Potential Issues

#### 3.1 Language Handling and Multi‑language Content

- `language` field is present on some articles (e.g. `pl` for Radomir, `de` for Olaf, `ru` for Anastasia & Radomir translations), but is no longer used for filtering.\n  - This is **intentional** so that each article appears in its original language regardless of site locale.\n  - **Risk for future features:** if we ever add multiple language versions of the *same* article (e.g. EN+RU with same slug or topic), the current model cannot distinguish them:\n    - `slug` must be unique across all languages,\n    - there is no canonical grouping by \"concept\" vs \"translation\".\n\n**Suggested approach for future multi‑version support**\n- If we need true multi‑lingual variants:\n  - Introduce a `canonicalSlug` or `articleId` and treat `language` as variant dimension.\n  - Adjust `fetchAnalyticsBySlug` and routing to handle `slug + language` or `canonicalSlug + locale`.\n  - Keep current behaviour (\"show all languages at once\") unless a user actively filters by language.

#### 3.2 Data Volume and Client‑side Processing

- All analytics articles (200+ and growing) are fetched as a single array from `fetchAnalytics` and filtered/sliced on the client.\n  - `useAnalytics` always returns the full type‑filtered list; `/analytics` then applies author filter + pagination.\n  - **Risk:** as the content library grows into several hundred or thousands of articles:\n    - initial JS payload and query result size increase,\n    - client‑side sort/filter work becomes heavier,\n    - pagination over a large in‑memory array can affect responsiveness on low‑end devices.\n\n**Suggested improvements**\n- Medium term: introduce server‑side pagination for analytics via Supabase/Edge Function (`fetch-analytics`):\n  - Query by `type`, `author`, maybe `tags`, with `limit/offset` or cursor.\n  - Keep `quickAnalytics` as fallback/dev mode.\n- Short term: lazy‑load additional article chunks in `/analytics` when user navigates deeper into pages (e.g. prefetch next page range and cache).

#### 3.3 Author Metadata and Counts

- Author list for filters is driven by `src/data/authors.ts`, while articles use `author: string` fields.\n  - `authorCounts` is computed by iterating over `articles` returned by `useAnalytics` and grouping by `article.author`.\n  - **Risks:**\n    - Inconsistencies between `author.display_name` and `article.author` (typos, diacritics) could lead to mismatched counts (author pill shows `0` even though there are articles).\n    - If an author is removed or renamed in `authors.ts` but their articles remain, those articles become effectively \"orphaned\" in the filter UI.\n\n**Suggested improvements**\n- Enforce a single source of truth for author IDs:\n  - Instead of free‑form `author: string`, use an `authorId` referencing `authors.id` and map to display_name/avatar via code.\n  - Keep a small migration utility that checks all `AnalyticsArticle` entries for unknown author names.\n- Optionally show a debug warning in dev builds when an article’s `author` has no match in `authors`.

#### 3.4 Image Handling

- `imageUrl` is required on `AnalyticsArticle` and is either:\n  - generated from local assets: `getAnalyticsImage(slug) → /analytics/<slug>.jpg`, or\n  - direct external URL (e.g. Unsplash) for specific authors/series (Radomir, Olaf, some Anastasia articles).\n  - `AnalyticsCard` relies on `LazyImage` for fallback behaviour.\n\n**Risks**\n- For local assets:\n  - Missing `/public/analytics/<slug>.jpg` yields a fallback in `LazyImage`, but there is no build‑time check that all `getAnalyticsImage(slug)` paths exist.\n- For external URLs:\n  - If a URL becomes invalid or rate‑limited, cards will rely on `LazyImage` fallback; the visual style may vary from other analytics images.\n\n**Suggested improvements**\n- Add a small dev‑time check (script) that:\n  - scans all `imageUrl: getAnalyticsImage('<slug>')` usages and verifies the corresponding files exist in `/public/analytics`.\n  - reports missing assets in CI or in a local `npm run check:assets` task.\n- For external images:\n  - Optionally standardize Unsplash queries (e.g. central helper to generate URLs by theme) to keep visual style consistent.\n

#### 3.5 Article Structure and Perceived \"AI‑ness\"

- Several series (especially equity‑market overviews by Anastasia Petrova) share **very similar structural skeletons**:\n  - `# <Country> Equity Markets: ...`\n  - `## Introduction`\n  - `## Market Fundamentals` (Market Structure / Economic Fundamentals)\n  - `## Investment Opportunities` etc.\n  - While this is analytically sound, visually it can make articles feel templated/AI‑generated.\n\n**Risks**\n- Readers may perceive the content as less human/unique, even if the substance is good.\n- It becomes harder to keep attention across multiple similar articles in sequence (e.g. scrolling the Anastasia feed).\n\n**Suggested improvements**\n- Progressively diversify structure for key series:\n  - For a subset of countries, start with a **case study** or a **market narrative** instead of a standard Introduction.\n  - Replace `Market Fundamentals` with variations like \"Macro Context\", \"Market Microstructure\", \"Flow & Positioning\" in some articles.\n  - Vary section order and depth: some articles shorter (briefs), others with deeper `Scenario Analysis` or `FAQs` sections.\n- For new articles, consciously avoid reusing the exact same heading skeleton; use the flexibility of `sections`/`tags` metadata.

#### 3.6 Analytics Usage in Other Features (Search, Recommendations, Notifications)

- Other parts of the app consume analytics data:\n  - Global search (companies/news/forum/tickers/authors) may surface analytics articles.\n  - Recommendation widgets (e.g. `TrendingContent`, `FollowAuthors`, home `AnalyticsSection`) and notifications may rely on counts and recency.\n\n**Risks**\n- If some components query analytics via direct imports (`christinaArticles` etc.) and others via `fetchAnalytics`, the sets used in different places can drift.\n- Future changes to `fetchAnalytics` (e.g. pagination, status flags, feature toggles) could break downstream logic if it expects a full in‑memory list.\n\n**Suggested improvements**\n- Standardize on `fetchAnalytics` / `useAnalytics` as the gateway for **all** read‑only analytics consumption in the UI.\n- If/when pagination is introduced, provide dedicated helper functions for \"top N\" / \"featured\" that encapsulate the new querying logic.

### 4. Summary and Next Steps

- Analytics is currently a **static, file‑backed content system** with:\n  - rich per‑author modules,\n  - a unified aggregation function (`fetchAnalytics`),\n  - flexible client‑side filtering (type, author, pagination),\n  - and language metadata that is descriptive but not filtering behaviour.\n- The main **technical** risks are around future scalability (data volume, possible need for server‑side pagination) and asset consistency (image URLs, author mapping).\n- The main **UX/content** risks are around structural repetition in some article series and mixed‑language feeds when more localized content is added.\n\nIf we decide to evolve Analytics further, logical next steps would be:\n1. Introduce a small asset & author consistency check (scripts to validate slugs→images, authors→profiles).\n2. Plan a migration path from file‑based analytics to a database/MDX or CMS‑backed model, keeping `AnalyticsArticle` API stable.\n3. Continue diversifying article structures and tone for key authors to strengthen the \"human\" feel of content while preserving analytical depth.\n+

